var U=Object.defineProperty,$=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var I=(e,s,r)=>s in e?U(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r,m=(e,s)=>{for(var r in s||(s={}))F.call(s,r)&&I(e,r,s[r]);if(O)for(var r of O(s))L.call(s,r)&&I(e,r,s[r]);return e},_=(e,s)=>$(e,q(s));import{_ as z,W as b,al as D,am as M,an as Q,R as h,ao as j,ap as P,aq as W,ar as V,J as w,as as H,at as S,Z as J,b as c,j as a,Y as G,B as K,u as x,d as Y,h as Z,C as X,i as ee}from"./index.4c085f80.js";import{a as te,V as re}from"./index.esm.8271dc6d.js";import{R as N,T as ne}from"./TextFitler.650cefac.js";import{f as se}from"./index.cd34981b.js";import{F as ie,p as oe}from"./Fab.3ac95401.js";import{u as ae}from"./useRemainingViewPortHeight.60456577.js";import"./rotate-cw.f6a28e9d.js";import"./debounce.d080d5e1.js";var ue=function(e){z(s,e);function s(i,n){var t;return t=e.call(this)||this,t.client=i,t.setOptions(n),t.bindMethods(),t.updateResult(),t}var r=s.prototype;return r.bindMethods=function(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)},r.setOptions=function(n){this.options=this.client.defaultMutationOptions(n)},r.onUnsubscribe=function(){if(!this.listeners.length){var n;(n=this.currentMutation)==null||n.removeObserver(this)}},r.onMutationUpdate=function(n){this.updateResult();var t={listeners:!0};n.type==="success"?t.onSuccess=!0:n.type==="error"&&(t.onError=!0),this.notify(t)},r.getCurrentResult=function(){return this.currentResult},r.reset=function(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})},r.mutate=function(n,t){return this.mutateOptions=t,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,b({},this.options,{variables:typeof n!="undefined"?n:this.options.variables})),this.currentMutation.addObserver(this),this.currentMutation.execute()},r.updateResult=function(){var n=this.currentMutation?this.currentMutation.state:D(),t=b({},n,{isLoading:n.status==="loading",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset});this.currentResult=t},r.notify=function(n){var t=this;M.batch(function(){t.mutateOptions&&(n.onSuccess?(t.mutateOptions.onSuccess==null||t.mutateOptions.onSuccess(t.currentResult.data,t.currentResult.variables,t.currentResult.context),t.mutateOptions.onSettled==null||t.mutateOptions.onSettled(t.currentResult.data,null,t.currentResult.variables,t.currentResult.context)):n.onError&&(t.mutateOptions.onError==null||t.mutateOptions.onError(t.currentResult.error,t.currentResult.variables,t.currentResult.context),t.mutateOptions.onSettled==null||t.mutateOptions.onSettled(void 0,t.currentResult.error,t.currentResult.variables,t.currentResult.context))),n.listeners&&t.listeners.forEach(function(o){o(t.currentResult)})})},s}(Q);function E(e,s,r){var i=h.useRef(!1),n=h.useState(0),t=n[1],o=j(e,s,r),d=P(),u=h.useRef();u.current?u.current.setOptions(o):u.current=new ue(d,o);var l=u.current.getCurrentResult();h.useEffect(function(){i.current=!0;var R=u.current.subscribe(M.batchCalls(function(){i.current&&t(function(y){return y+1})}));return function(){i.current=!1,R()}},[]);var p=h.useCallback(function(R,y){u.current.mutate(R,y).catch(W)},[]);if(l.error&&V(void 0,u.current.options.useErrorBoundary,[l.error]))throw l.error;return b({},l,{mutate:p,mutateAsync:l.mutate})}function le(e){const s=e.providers,r=Object.keys(s),i={};for(let n=0;n<r.length;n++){const t=r[n];i[t]=_(m({},s[t]),{idx:n})}return{byName:i,names:r}}async function ce(e,s){const{url:r,init:i}=w(s);let n={providers:{}};try{const t=await fetch(r+e,i);t.ok&&(n=await t.json())}catch(t){console.log("failed to GET /providers/rules",t)}return le(n)}async function B({name:e,apiConfig:s}){const{url:r,init:i}=w(s);try{return(await fetch(r+`/providers/rules/${e}`,m({method:"PUT"},i))).ok}catch(n){return console.log("failed to PUT /providers/rules/:name",n),!1}}async function de({names:e,apiConfig:s}){for(let r=0;r<e.length;r++)await B({name:e[r],apiConfig:s})}var fe=function(e,s,r,i,n,t,o,d){if(!e){var u;if(s===void 0)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[r,i,n,t,o,d],p=0;u=new Error(s.replace(/%s/g,function(){return l[p++]})),u.name="Invariant Violation"}throw u.framesToPop=1,u}},me=fe;function he(e){return me(e.rules&&e.rules.length>=0,"there is no valid rules list in the rules API response"),e.rules.map((s,r)=>_(m({},s),{id:r}))}async function ve(e,s){let r={rules:[]};try{const{url:i,init:n}=w(s),t=await fetch(i+e,n);t.ok&&(r=await t.json())}catch(i){console.log("failed to fetch rules",i)}return he(r)}const T=H({key:"ruleFilterText",default:""});function pe(e,s){const r=P(),{mutate:i,isLoading:n}=E(B,{onSuccess:()=>{r.invalidateQueries("/providers/rules")}});return[o=>{o.preventDefault(),i({name:e,apiConfig:s})},n]}function Re(e){const s=P(),{data:r}=k(e),{mutate:i,isLoading:n}=E(de,{onSuccess:()=>{s.invalidateQueries("/providers/rules")}});return[o=>{o.preventDefault(),i({names:r.names,apiConfig:e})},n]}function k(e){return S(["/providers/rules",e],()=>ce("/providers/rules",e))}function ye(e){const{data:s,isFetching:r}=S(["/rules",e],()=>ve("/rules",e)),{data:i}=k(e),[n]=J(T);if(n==="")return{rules:s,provider:i,isFetching:r};{const t=n.toLowerCase();return{rules:s.filter(o=>o.payload.toLowerCase().indexOf(t)>=0),isFetching:r,provider:{byName:i.byName,names:i.names.filter(o=>o.toLowerCase().indexOf(t)>=0)}}}}const _e="_RuleProviderItem_12aid_1",ge="_left_12aid_7",be="_middle_12aid_14",Pe="_gray_12aid_21",we="_action_12aid_25",Oe="_refreshBtn_12aid_32";var f={RuleProviderItem:_e,left:ge,middle:be,gray:Pe,action:we,refreshBtn:Oe};function Ie({idx:e,name:s,vehicleType:r,behavior:i,updatedAt:n,ruleCount:t,apiConfig:o}){const[d,u]=pe(s,o),l=se(new Date(n),new Date);return c("div",{className:f.RuleProviderItem,children:[a("span",{className:f.left,children:e}),c("div",{className:f.middle,children:[a(G,{name:s,type:`${r} / ${i}`}),a("div",{className:f.gray,children:t<2?`${t} rule`:`${t} rules`}),c("div",{className:f.action,children:[c(K,{onClick:d,disabled:u,className:f.refreshBtn,children:[a(N,{isRotating:u,size:13}),a("span",{className:"visually-hidden",children:"Refresh"})]}),c("small",{className:f.gray,children:["Updated ",l," ago"]})]})]})]})}function Ce({apiConfig:e}){const[s,r]=Re(e),{t:i}=x();return a(ie,{icon:a(N,{isRotating:r}),text:i("update_all_rule_provider"),style:oe,onClick:s})}const Me="_rule_1ymqx_1",Se="_left_1ymqx_12",xe="_a_1ymqx_19",Ne="_b_1ymqx_26",Ee="_type_1ymqx_37";var v={rule:Me,left:Se,a:xe,b:Ne,type:Ee};const g={_default:"#59caf9",DIRECT:"#f5bc41",REJECT:"#cb3166"};function Be({proxy:e}){let s=g._default;return g[e]&&(s=g[e]),{color:s}}function Te({type:e,payload:s,proxy:r,id:i}){const n=Be({proxy:r});return c("div",{className:v.rule,children:[a("div",{className:v.left,children:i}),c("div",{children:[a("div",{className:v.b,children:s}),c("div",{className:v.a,children:[a("div",{className:v.type,children:e}),a("div",{style:n,children:r})]})]})]})}const ke="_header_1j1w3_1",Ae="_RuleProviderItemWrapper_1j1w3_17";var A={header:ke,RuleProviderItemWrapper:Ae};const{memo:Ue}=ee,C=30;function $e(e,{rules:s,provider:r}){const i=r.names.length;return e<i?r.names[e]:s[e-i].id}function qe({provider:e}){return function(r){const i=e.names.length;return r<i?110:80}}const Fe=Ue(({index:e,style:s,data:r})=>{const{rules:i,provider:n,apiConfig:t}=r,o=n.names.length;if(e<o){const u=n.names[e],l=n.byName[u];return a("div",{style:s,className:A.RuleProviderItemWrapper,children:a(Ie,m({apiConfig:t},l))})}const d=i[e-o];return a("div",{style:s,children:a(Te,m({},d))})},te),Le=e=>({apiConfig:Z(e)});var Ye=Y(Le)(ze);function ze({apiConfig:e}){const[s,r]=ae(),{rules:i,provider:n}=ye(e),t=qe({provider:n}),{t:o}=x();return c("div",{children:[c("div",{className:A.header,children:[a(X,{title:o("Rules")}),a(ne,{placeholder:"Filter",textAtom:T})]}),a("div",{ref:s,style:{paddingBottom:C},children:a(re,{height:r-C,width:"100%",itemCount:i.length+n.names.length,itemSize:t,itemData:{rules:i,provider:n,apiConfig:e},itemKey:$e,children:Fe})}),n&&n.names&&n.names.length>0?a(Ce,{apiConfig:e}):null]})}export{Ye as default};
