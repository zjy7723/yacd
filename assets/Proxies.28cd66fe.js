var be=Object.defineProperty,we=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var W=(e,t,r)=>t in e?be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,F=(e,t)=>{for(var r in t||(t={}))ke.call(t,r)&&W(e,r,t[r]);if(V)for(var r of V(t))Pe.call(t,r)&&W(e,r,t[r]);return e},j=(e,t)=>we(e,Ce(t));import{r as g,j as o,P as $,c as w,X as Se,b as c,B as b,i as m,Y as Ne,Z as $e,$ as oe,a0 as se,d as C,a1 as Ae,F as T,a2 as Le,a3 as ae,a4 as q,x as D,a5 as Oe,a6 as le,a7 as O,a8 as ie,a9 as E,aa as U,ab as Te,ac as De,u as K,ad as Be,ae as Ie,af as Fe,h as ce,C as ue,D as Y,ag as je,m as X,M as Re,ah as ze,ai as Me,aj as He,ak as qe}from"./index.4c085f80.js";import{C as Ee}from"./chevron-down.a90d90ea.js";import{F as Ue,p as Ke,A as Ze,I as Ge}from"./Fab.3ac95401.js";import{R as Ve,T as We}from"./TextFitler.650cefac.js";import{f as Ye}from"./index.cd34981b.js";import{R as Xe}from"./rotate-cw.f6a28e9d.js";import{S as Je}from"./Select.fcc21c26.js";import"./debounce.d080d5e1.js";function Qe(e,t){if(e==null)return{};var r=et(e,t),n,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)n=a[s],!(t.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function et(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,a;for(a=0;a<n.length;a++)s=n[a],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}var Z=g.exports.forwardRef(function(e,t){var r=e.color,n=r===void 0?"currentColor":r,s=e.size,a=s===void 0?24:s,l=Qe(e,["color","size"]);return o("svg",j(F({ref:t,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},l),{children:o("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})}))});Z.propTypes={color:$.string,size:$.oneOfType([$.string,$.number])};Z.displayName="Zap";var J=Z;function de(e){const t=e.size||24,r=w({[Se.animate]:e.animate});return o("svg",{className:r,xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})})}const tt="_FlexCenter_1380a_1";var rt={FlexCenter:tt};function nt({children:e}){return o("div",{className:rt.FlexCenter,children:e})}const{useRef:Q,useEffect:ot}=m;function st({onClickPrimaryButton:e,onClickSecondaryButton:t}){const r=Q(null),n=Q(null);return ot(()=>{r.current.focus()},[]),c("div",{onKeyDown:a=>{a.keyCode===39?n.current.focus():a.keyCode===37&&r.current.focus()},children:[o("h2",{children:"Close Connections?"}),o("p",{children:'Click "Yes" to close those connections that are still using the old selected proxy in this group'}),o("div",{style:{height:30}}),c(nt,{children:[o(b,{onClick:e,ref:r,children:"Yes"}),o("div",{style:{width:20}}),o(b,{onClick:t,ref:n,children:"No"})]})]})}const at="_header_1y9js_1",lt="_arrow_1y9js_8",it="_isOpen_1y9js_13",ct="_btn_1y9js_20",ut="_qty_1y9js_25";var k={header:at,arrow:lt,isOpen:it,btn:ct,qty:ut};function pe({name:e,type:t,toggle:r,isOpen:n,qty:s}){const a=g.exports.useCallback(l=>{l.preventDefault(),(l.key==="Enter"||l.key===" ")&&r()},[r]);return c("div",{className:k.header,onClick:r,style:{cursor:"pointer"},tabIndex:0,onKeyDown:a,role:"button",children:[o("div",{children:o(Ne,{name:e,type:t})}),typeof s=="number"?o("span",{className:k.qty,children:s}):null,o(b,{kind:"minimal",onClick:r,className:k.btn,title:"Toggle collapsible section",children:o("span",{className:w(k.arrow,{[k.isOpen]:n}),children:o(Ee,{size:20})})})]})}const{useMemo:dt}=m;function pt(e,t){return e.filter(r=>{const n=t[r];return n===void 0?!0:n.number!==0})}const A=(e,t)=>{if(e&&typeof e.number=="number"&&e.number>0)return e.number;const r=t&&t.type;return r&&se.indexOf(r)>-1?-1:999999},ht={Natural:e=>e,LatencyAsc:(e,t,r)=>e.sort((n,s)=>{const a=A(t[n],r&&r[n]),l=A(t[s],r&&r[s]);return a-l}),LatencyDesc:(e,t,r)=>e.sort((n,s)=>{const a=A(t[n],r&&r[n]);return A(t[s],r&&r[s])-a}),NameAsc:e=>e.sort(),NameDesc:e=>e.sort((t,r)=>t>r?-1:t<r?1:0)};function yt(e,t){const r=t.toLowerCase().split(" ").map(n=>n.trim()).filter(n=>!!n);return r.length===0?e:e.filter(n=>{let s=0;for(;s<r.length;s++){const a=r[s];if(n.toLowerCase().indexOf(a)>-1)return!0}return!1})}function ft(e,t,r,n,s,a){let l=[...e];return r&&(l=pt(e,t)),typeof n=="string"&&n!==""&&(l=yt(l,n)),ht[s](l,t,a)}function he(e,t,r,n,s){const[a]=$e(oe);return dt(()=>ft(e,t,r,a,n,s),[e,t,r,a,n,s])}const mt="_header_5pmv2_1",vt="_groupHead_5pmv2_5",_t="_action_5pmv2_11";var R={header:mt,groupHead:vt,action:_t};const xt="_proxy_8ev0l_1",gt="_now_8ev0l_25",bt="_error_8ev0l_29",wt="_selectable_8ev0l_32",Ct="_proxyType_8ev0l_40",kt="_row_8ev0l_51",Pt="_proxyName_8ev0l_57",St="_proxySmall_8ev0l_66";var f={proxy:xt,now:gt,error:bt,selectable:wt,proxyType:Ct,row:kt,proxyName:Pt,proxySmall:St};const Nt="_proxyLatency_hz69v_1";var $t={proxyLatency:Nt};function At({number:e,color:t}){return o("span",{className:$t.proxyLatency,style:{color:t},children:typeof e=="number"&&e!==0?e+" ms":" "})}const{useMemo:N}=m,P={good:"#67c23a",normal:"#d4b75c",bad:"#e67f3c",na:"#909399"};function ye({number:e}={}){return e===0?P.na:e<200?P.good:e<400?P.normal:typeof e=="number"?P.bad:P.na}function Lt(e,t){return se.indexOf(t)>-1?{border:"1px dotted #777"}:{background:ye(e)}}function Ot({now:e,name:t,proxy:r,latency:n,isSelectable:s,onClick:a}){const l=N(()=>Lt(n,r.type),[n,r]),i=N(()=>{let d=t;return n&&typeof n.number=="number"&&(d+=" "+n.number+" ms"),d},[t,n]),u=g.exports.useCallback(()=>{s&&a&&a(t)},[t,a,s]),p=N(()=>w(f.proxySmall,{[f.now]:e,[f.selectable]:s}),[s,e]),h=g.exports.useCallback(d=>{d.key==="Enter"&&u()},[u]);return o("div",{title:i,className:p,style:l,onClick:u,onKeyDown:h,role:s?"menuitem":""})}function Tt(e){return e==="Shadowsocks"?"SS":e}const Dt=e=>({left:e.left+window.scrollX-5,top:e.top+window.scrollY-38});function Bt({children:e,label:t,"aria-label":r}){const[n,s]=Ae();return c(T,{children:[g.exports.cloneElement(e,n),o(Le,j(F({},s),{label:t,"aria-label":r,position:Dt}))]})}function It({now:e,name:t,proxy:r,latency:n,isSelectable:s,onClick:a}){const l=N(()=>ye(n),[n]),i=g.exports.useCallback(()=>{s&&a&&a(t)},[t,a,s]),u=g.exports.useCallback(h=>{h.key==="Enter"&&i()},[i]),p=N(()=>w(f.proxy,{[f.now]:e,[f.error]:n&&n.error,[f.selectable]:s}),[s,e,n]);return c("div",{tabIndex:0,className:p,onClick:i,onKeyDown:u,role:s?"menuitem":"",children:[o("div",{className:f.proxyName,children:o(Bt,{label:t,"aria-label":"proxy name: "+t,children:o("span",{children:t})})}),c("div",{className:f.row,children:[o("span",{className:f.proxyType,style:{opacity:e?.6:.2},children:Tt(r.type)}),o(At,{number:n==null?void 0:n.number,color:l})]})]})}const fe=(e,{name:t})=>{const r=ae(e),n=q(e);return{proxy:r[t],latency:n[t]}},Ft=C(fe)(It),jt=C(fe)(Ot),Rt="_list_1oy7w_1",zt="_listSummaryView_1oy7w_8";var me={list:Rt,listSummaryView:zt};function ve({all:e,now:t,isSelectable:r,itemOnTapCallback:n}){const s=e;return o("div",{className:me.list,children:s.map(a=>o(Ft,{onClick:n,isSelectable:r,name:a,now:a===t},a))})}function _e({all:e,now:t,isSelectable:r,itemOnTapCallback:n}){return o("div",{className:me.listSummaryView,children:e.map(s=>o(jt,{onClick:n,isSelectable:r,name:s,now:s===t},s))})}const{createElement:Mt,useCallback:z,useMemo:Ht}=m;function qt({name:e,all:t,delay:r,hideUnavailableProxies:n,proxySortBy:s,proxies:a,type:l,now:i,isOpen:u,apiConfig:p,dispatch:h}){const d=he(t,r,n,s,a),_=Ht(()=>l==="Selector",[l]),{app:{updateCollapsibleIsOpen:x},proxies:{requestDelayForProxies:y}}=D(),B=z(()=>{x("proxyGroup",e,!u)},[u,x,e]),I=z(G=>{!_||h(Oe(p,e,G))},[p,h,e,_]),v=le(!1),ge=z(async()=>{if(!v.value){v.set(!0);try{await y(p,d)}catch{}v.set(!1)}},[d,p,y,v]);return c("div",{className:R.group,children:[c("div",{className:R.groupHead,children:[o(pe,{name:e,type:l,toggle:B,qty:d.length,isOpen:u}),o("div",{className:R.action,children:o(O,{label:"Test latency",children:o(b,{kind:"circular",onClick:ge,children:o(de,{animate:v.value,size:16})})})})]}),Mt(u?ve:_e,{all:d,now:i,isSelectable:_,itemOnTapCallback:I})]})}const Et=C((e,{name:t,delay:r})=>{const n=ae(e),s=ie(e),a=E(e),l=U(e),i=n[t],{all:u,type:p,now:h}=i;return{all:u,delay:r,hideUnavailableProxies:l,proxySortBy:a,proxies:n,type:p,now:h,isOpen:s[`proxyGroup:${t}`]}})(qt),{useCallback:xe,useState:Ut}=m;function Kt({dispatch:e,apiConfig:t,name:r}){return xe(()=>e(Te(t,r)),[t,e,r])}function Zt({dispatch:e,apiConfig:t,names:r}){const[n,s]=Ut(!1);return[xe(async()=>{if(!n){s(!0);try{await e(De(t,r))}catch{}s(!1)}},[t,e,r,n]),n]}const{useState:Gt,useCallback:Vt}=m;function Wt({isLoading:e}){return e?o(Ge,{children:o(J,{width:16,height:16})}):o(J,{width:16,height:16})}function Yt({dispatch:e,apiConfig:t}){const[r,n]=Gt(!1);return[Vt(()=>{r||(n(!0),e(Be(t)).then(()=>n(!1),()=>n(!1)))},[t,e,r]),r]}function Xt({dispatch:e,apiConfig:t,proxyProviders:r}){const{t:n}=K(),[s,a]=Yt({dispatch:e,apiConfig:t}),[l,i]=Zt({apiConfig:t,dispatch:e,names:r.map(u=>u.name)});return o(Ue,{icon:o(Wt,{isLoading:a}),onClick:s,text:n("Test Latency"),style:Ke,children:r.length>0?o(Ze,{text:n("update_all_proxy_provider"),onClick:l,children:o(Ve,{isRotating:i})}):null})}const Jt="_updatedAt_1rx92_1",Qt="_main_1rx92_8",er="_head_1rx92_17",tr="_action_1rx92_23",rr="_refresh_1rx92_31";var S={updatedAt:Jt,main:Qt,head:er,action:tr,refresh:rr};const{useCallback:ee}=m;function nr({name:e,proxies:t,delay:r,hideUnavailableProxies:n,proxySortBy:s,vehicleType:a,updatedAt:l,isOpen:i,dispatch:u,apiConfig:p}){const h=he(t,r,n,s),d=le(!1),_=Kt({dispatch:u,apiConfig:p,name:e}),x=ee(()=>{if(d.value)return;d.set(!0);const v=()=>d.set(!1);u(Ie(p,e)).then(v,v)},[p,u,e,d]),{app:{updateCollapsibleIsOpen:y}}=D(),B=ee(()=>{y("proxyProvider",e,!i)},[i,y,e]),I=Ye(new Date(l),new Date);return c("div",{className:S.main,children:[c("div",{className:S.head,children:[o(pe,{name:e,toggle:B,type:a,isOpen:i,qty:h.length}),c("div",{className:S.action,children:[o(O,{label:"Update",children:o(b,{kind:"circular",onClick:_,children:o(ar,{})})}),o(O,{label:"Health Check",children:o(b,{kind:"circular",onClick:x,children:o(de,{animate:d.value,size:16})})})]})]}),o("div",{className:S.updatedAt,children:c("small",{children:["Updated ",I," ago"]})}),i?o(ve,{all:h}):o(_e,{all:h})]})}const or={rest:{scale:1},pressed:{scale:.95}},sr={rest:{rotate:0},hover:{rotate:360,transition:{duration:.3}}};function ar(){const t=Fe.read().motion;return o(t.div,{className:S.refresh,variants:or,initial:"rest",whileHover:"hover",whileTap:"pressed",children:o(t.div,{className:"flexCenter",variants:sr,children:o(Xe,{size:16})})})}const lr=(e,{proxies:t,name:r})=>{const n=U(e),s=q(e),a=ie(e),l=ce(e),i=E(e);return{apiConfig:l,proxies:t,delay:s,hideUnavailableProxies:n,proxySortBy:i,isOpen:a[`proxyProvider:${r}`]}},ir=C(lr)(nr);function cr({items:e}){return e.length===0?null:c(T,{children:[o(ue,{title:"Proxy Provider"}),o("div",{children:e.map(t=>o(ir,{name:t.name,proxies:t.proxies,type:t.type,vehicleType:t.vehicleType,updatedAt:t.updatedAt},t.name))})]})}const ur="_labeledInput_cmki0_1";var M={labeledInput:ur};const dr=[["Natural","order_natural"],["LatencyAsc","order_latency_asc"],["LatencyDesc","order_latency_desc"],["NameAsc","order_name_asc"],["NameDesc","order_name_desc"]],{useCallback:te}=m;function pr({appConfig:e}){const{app:{updateAppConfig:t}}=D(),r=te(a=>{t("proxySortBy",a.target.value)},[t]),n=te(a=>{t("hideUnavailableProxies",a)},[t]),{t:s}=K();return c(T,{children:[c("div",{className:M.labeledInput,children:[o("span",{children:s("sort_in_grp")}),o("div",{children:o(Je,{options:dr.map(a=>[a[0],s(a[1])]),selected:e.proxySortBy,onChange:r})})]}),o("hr",{}),c("div",{className:M.labeledInput,children:[o("span",{children:s("hide_unavail_proxies")}),o("div",{children:o(Y,{name:"hideUnavailableProxies",checked:e.hideUnavailableProxies,onChange:n})})]}),c("div",{className:M.labeledInput,children:[o("span",{children:s("auto_close_conns")}),o("div",{children:o(Y,{name:"autoCloseOldConns",checked:e.autoCloseOldConns,onChange:a=>t("autoCloseOldConns",a)})})]})]})}const hr=e=>{const t=E(e),r=U(e),n=je(e);return{appConfig:{proxySortBy:t,hideUnavailableProxies:r,autoCloseOldConns:n}}};var yr=C(hr)(pr);const fr="_overlay_uuk3b_1",mr="_cnt_uuk3b_5",vr="_afterOpen_uuk3b_16";var H={overlay:fr,cnt:mr,afterOpen:vr};const{useMemo:_r}=m;function re({isOpen:e,onRequestClose:t,children:r}){const n=_r(()=>({base:w(X.content,H.cnt),afterOpen:H.afterOpen,beforeClose:""}),[]);return o(Re,{isOpen:e,onRequestClose:t,className:n,overlayClassName:w(X.overlay,H.overlay),children:r})}function xr({color:e="currentColor",size:t=24}){return c("svg",{fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:t,height:t,stroke:e,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o("path",{d:"M2 6h9M18.5 6H22"}),o("circle",{cx:"16",cy:"6",r:"2"}),o("path",{d:"M22 18h-9M6 18H2"}),o("circle",{r:"2",transform:"matrix(-1 0 0 1 8 18)"})]})}const gr="_topBar_jgy4z_1",br="_topBarRight_jgy4z_13",wr="_textFilterContainer_jgy4z_22",Cr="_group_jgy4z_29";var L={topBar:gr,topBarRight:br,textFilterContainer:wr,group:Cr};const{useState:kr,useEffect:Pr,useCallback:ne,useRef:Sr}=m;function Nr({dispatch:e,groupNames:t,delay:r,proxyProviders:n,apiConfig:s,showModalClosePrevConns:a}){const l=Sr({}),i=ne(()=>{l.current.startAt=Date.now(),e(ze(s)).then(()=>{l.current.completeAt=Date.now()})},[s,e]);Pr(()=>{i();const y=()=>{l.current.startAt&&Date.now()-l.current.startAt>3e4&&i()};return window.addEventListener("focus",y,!1),()=>window.removeEventListener("focus",y,!1)},[i]);const[u,p]=kr(!1),h=ne(()=>{p(!1)},[]),{proxies:{closeModalClosePrevConns:d,closePrevConnsAndTheModal:_}}=D(),{t:x}=K();return c(T,{children:[o(re,{isOpen:u,onRequestClose:h,children:o(yr,{})}),c("div",{className:L.topBar,children:[o(ue,{title:x("Proxies")}),c("div",{className:L.topBarRight,children:[o("div",{className:L.textFilterContainer,children:o(We,{textAtom:oe})}),o(O,{label:x("settings"),children:o(b,{kind:"minimal",onClick:()=>p(!0),children:o(xr,{size:16})})})]})]}),o("div",{children:t.map(y=>o("div",{className:L.group,children:o(Et,{name:y,delay:r,apiConfig:s,dispatch:e})},y))}),o(cr,{items:n}),o("div",{style:{height:60}}),o(Xt,{dispatch:e,apiConfig:s,proxyProviders:n}),o(re,{isOpen:a,onRequestClose:d,children:o(st,{onClickPrimaryButton:()=>_(s),onClickSecondaryButton:d})})]})}const $r=e=>({apiConfig:ce(e),groupNames:Me(e),proxyProviders:He(e),delay:q(e),showModalClosePrevConns:qe(e)});var Rr=C($r)(Nr);export{Rr as default};
